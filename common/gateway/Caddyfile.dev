{
    auto_https off
}

:80 {
    # Proxy to Vite dev server (non-API requests)
    @notApi {
        not path /api/*
    }
    handle @notApi {
        reverse_proxy client_dev:5173
    }

    # Proxy PostgREST API requests
    handle /api/db/* {
        uri strip_prefix /api/db
        reverse_proxy postgrest:3000
    }

    # Proxy Printer Service API requests
    handle /api/printer/* {
        uri strip_prefix /api/printer
        reverse_proxy printer_service:8000
    }

    encode gzip

    log {
        output stdout
        format console
    }
}
